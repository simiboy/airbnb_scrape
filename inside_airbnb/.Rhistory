setwd("C:/Users/ThinkPad/Desktop/airbnb_scrape/inside_airbnb")
library(tidyverse)
library(tidyverse)
# 1. List all CSV files named listings.csv in subdirectories
csv_files <- list.files(path = ".", pattern = "listings\\.csv$", recursive = TRUE, full.names = TRUE)
library(tidyverse)
# 1. List all CSV files named listings.csv in subdirectories
csv_files <- list.files(path = ".", pattern = "listings\\.csv$", recursive = TRUE, full.names = TRUE)
# 2. Function to load each CSV and attach the date from the folder name
read_with_date <- function(file) {
# extract date from folder name (assuming folder name like "2024-12-04")
folder_name <- basename(dirname(file))
date <- as.Date(folder_name, format = "%Y-%m-%d")
# read the csv
df <- read_csv(file, show_col_types = FALSE)
# attach the date
df$date <- date
return(df)
}
# 3. Load and combine all CSVs
all_data <- map_dfr(csv_files, read_with_date)
# Inspect the combined data
cat("Loaded", nrow(all_data), "rows from", length(csv_files), "files.\n")
# 4. Summarize: average price and count per date
# (adjust "price" column name if different in your CSV)
summary_data <- all_data %>%
group_by(date) %>%
summarise(
avg_price = mean(price, na.rm = TRUE),
num_listings = n()
) %>%
arrange(date)
print(summary_data)
# 5. Plot average price over time
ggplot(summary_data, aes(x = date, y = avg_price)) +
geom_line(color = "steelblue", size = 1.2) +
geom_point(color = "darkblue") +
labs(title = "Average Listing Price Over Time",
x = "Date", y = "Average Price") +
theme_minimal()
# 6. Plot number of listings over time
ggplot(summary_data, aes(x = date, y = num_listings)) +
geom_col(fill = "darkorange") +
labs(title = "Number of Listings Over Time",
x = "Date", y = "Count of Listings") +
theme_minimal()
# analyze_districts.R
# Run this script from the parent folder that contains the date folders (e.g. 2024-12-04/)
library(tidyverse)
# 1. Find all 'listings.csv' files in subfolders
csv_files <- list.files(path = ".", pattern = "listings\\.csv$", recursive = TRUE, full.names = TRUE)
# 2. Function to read a CSV and attach its date (from folder name)
read_with_date <- function(file) {
folder_name <- basename(dirname(file))
date <- as.Date(folder_name, format = "%Y-%m-%d")
df <- read_csv(file, show_col_types = FALSE)
df$date <- date
return(df)
}
# 3. Combine all CSVs into one dataframe
all_data <- map_dfr(csv_files, read_with_date)
cat("Loaded", nrow(all_data), "rows from", length(csv_files), "files.\n")
# --- IMPORTANT ---
# If your district column has a different name, update it below.
# e.g. rename(neighbourhood = district)
if (!"district" %in% names(all_data)) {
stop("The data does not contain a column named 'district'. Update the script with the correct column name.")
}
View(all_data)
# --- IMPORTANT ---
# If your district column has a different name, update it below.
rename(neighbourhood = district)
# analyze_districts.R
# Run this script from the parent folder that contains the date folders (e.g. 2024-12-04/)
library(tidyverse)
# 1. Find all 'listings.csv' files in subfolders
csv_files <- list.files(path = ".", pattern = "listings\\.csv$", recursive = TRUE, full.names = TRUE)
# 2. Function to read a CSV and attach its date (from folder name)
read_with_date <- function(file) {
folder_name <- basename(dirname(file))
date <- as.Date(folder_name, format = "%Y-%m-%d")
df <- read_csv(file, show_col_types = FALSE)
df$date <- date
return(df)
}
# 3. Combine all CSVs into one dataframe
all_data <- map_dfr(csv_files, read_with_date)
cat("Loaded", nrow(all_data), "rows from", length(csv_files), "files.\n")
# 4. Summarize: number of listings over time by district
district_summary <- all_data %>%
group_by(date, neighbourhood) %>%
summarise(num_listings = n(), .groups = "drop") %>%
arrange(date, neighbourhood)
print(head(district_summary))
# 5. Plot number of listings over time by district
ggplot(district_summary, aes(x = date, y = num_listings, color = neighbourhood)) +
geom_line(size = 1.1) +
labs(
title = "Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Number of Listings",
color = "neighbourhood"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
# 4b. Normalize listings by first date for each district
district_summary <- district_summary %>%
group_by(neighbourhood) %>%
arrange(date) %>%
mutate(
num_listings_norm = 100 * num_listings / first(num_listings)
) %>%
ungroup()
# 5b. Plot number of listings relative to first date by district
ggplot(district_summary, aes(x = date, y = num_listings_norm)) +
geom_line(aes(color = ifelse(neighbourhood == "VI. kerület", "VI. kerület", "Other")), size = 1.1) +
scale_color_manual(values = c("VI. kerület" = "red", "Other" = "blue")) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
district_summary
View(district_summary)
# 5b. Plot number of listings relative to first date by district
ggplot(district_summary, aes(x = date, y = num_listings_norm)) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
# 5b. Plot number of listings relative to first date by district
ggplot(district_summary_norm, aes(x = date, y = num_listings_norm, color = neighbourhood)) +
geom_line(size = 1.1) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
# 5b. Plot number of listings relative to first date by district
ggplot(district_summary_norm, aes(x = date, y = num_listings_norm, color = neighbourhood)) +
geom_line(size = 1.1) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
# 5b. Plot number of listings relative to first date by district
ggplot(district_summary, aes(x = date, y = num_listings_norm, color = neighbourhood)) +
geom_line(size = 1.1) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
selected_districts <- c("I. kerület", "II. kerület", "V. kerület", "VI. kerület",
"VII. kerület", "VIII. kerület", "IX. kerület", "XI. kerület", "XIII. kerület")
district_summary_filtered <- district_summary %>%
filter(neighbourhood %in% selected_districts) %>%
group_by(neighbourhood) %>%
arrange(date) %>%
mutate(
num_listings_norm = 100 * num_listings / first(num_listings)
) %>%
ungroup()
# Set colors: VI red, others pale
colors <- c(
"I. kerület" = "#cccccc",
"II. kerület" = "#bbbbbb",
"V. kerület" = "#aaaaaa",
"VI. kerület" = "red",
"VII. kerület" = "#dddddd",
"VIII. kerület" = "#eeeeee",
"IX. kerület" = "#bbbbbb",
"XI. kerület" = "#cccccc",
"XIII. kerület" = "#dddddd"
)
# Plot
ggplot(district_summary_filtered, aes(x = date, y = num_listings_norm, color = neighbourhood)) +
geom_line(size = 1.1) +
scale_color_manual(values = colors) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
View(district_summary_filtered)
# Plot
ggplot(district_summary_filtered, aes(x = date, y = num_listings, color = neighbourhood)) +
geom_line(size = 1.1) +
scale_color_manual(values = colors) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
# Plot
ggplot(district_summary_filtered, aes(x = date, y = num_listings, color = neighbourhood)) +
geom_line(size = 1.1) +
scale_color_manual(values = colors) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
# Plot
ggplot(district_summary_filtered, aes(x = date, y = num_listings_norm, color = neighbourhood)) +
geom_line(size = 1.1) +
scale_color_manual(values = colors) +
labs(
title = "Change in Number of Listings Over Time by District (Budapest)",
x = "Date",
y = "Listings (% of first date)",
color = "District"
) +
theme_minimal() +
theme(legend.position = "right") +
scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
